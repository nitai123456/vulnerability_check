import os
import importlib

from vulnerabilities.vulnerability import Vulnerability

current_dir = os.path.dirname(__file__)

cve_directories = [name for name in os.listdir(current_dir) if os.path.isdir(os.path.join(current_dir, name))]

vulnerabilities = []

for cve in cve_directories:
    try:
        # Import the CVE module (which imports check and mitigate)
        module = importlib.import_module(f'.{cve}', package='vulnerabilities')

        # Retrieve the check and mitigate functions
        check_func = getattr(module, 'check', None)
        mitigate_func = getattr(module, 'mitigate', None)

        if check_func:
            vulnerabilities.append(Vulnerability(name=cve, check=check_func, mitigation=mitigate_func))
        else:
            print(f"Module {cve} does not have a check function")

    except ImportError as e:
        print(f"Failed to import module for {cve}: {e}")

__all__ = ['vulnerabilities', Vulnerability]
